SELECT o.order_id, quantity_per_unit, o.quantity as quantity_order, pr.units_in_stock, o.product_id, product_name
FROM Order_details AS o

INNER JOIN products AS pr ON o.product_id = pr.product_id
WHere o.order_id= 10895
ORDER BY quantity_order DESC


SELECT COUNT(*)
FROM order_details

SELECT o.order_id, Count(o.order_id)
FROM Order_details AS o

INNER JOIN orders AS ord ON o.order_id = ord.order_id
GROUP BY o.order_id

SELECT *
FROM Order_details 
WHERE order_id = 10248

SELECT *
FROM products 
WHERE product_id = 42

SELECT order_id, ROUND(SUM((unit_price * quantity )))  AS valor_total
FROM order_details
GROUP BY order_id
ORDER BY order_id

SELECT o.order_id, ROUND(SUM((pr.unit_price * o.quantity))) AS "VALOR TOTAL"
FROM order_details AS o
INNER JOIN products AS pr ON o.product_id = pr.product_id
GROUP BY  o.order_id
ORDER BY o.order_id

SELECT cus.contact_name, COUNT(o.order_id)
FROM customers AS cus
INNER JOIN orders AS o ON cus.customer_id = o.customer_id
GROUP BY 1
ORDER BY 2 DESC

SELECT unit_price, product_id FROM products
UNION 
SELECT unit_price, product_id  FROM order_details
ORDER BY 2

SELECT *
FROM order_details
WHERE product_id = 15


---maior comprador
SELECT  SUM(dt.unit_price * dt. quantity) AS "TOTAL", cust.contact_name
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 2
ORDER BY 1 DESC


---maior fatura
SELECT dt.order_id, SUM(dt.unit_price * dt. quantity) AS "TOTAL", cust.contact_name
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 3,1
ORDER BY 2 DESC


---Praticando INNER JOIN
---1
SELECT o.order_id, SUM((dt.unit_price * dt.quantity)* (1- discount)) + o.freight AS order_total
FROM order_details AS dt
INNER JOIN orders AS o ON dt.order_id = o.order_id
GROUP BY 1
ORDER BY 2 DESC

---2
SELECT cus.contact_name, COUNT(o.order_id)
FROM customers AS cus
INNER JOIN orders AS o ON cus.customer_id = o.customer_id
GROUP BY 1
ORDER BY 2 DESC
LIMIT 10

---3
SELECT o.order_id, SUM((dt.unit_price * dt. quantity) * (1- discount))+ o.freight AS "VALOR_TOTAL", 
       cust.contact_name
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 3,1
ORDER BY 2 DESC

---4
---volor total de cada order pra cada customer
SELECT o.order_id, cust.contact_name, SUM((dt.unit_price * dt. quantity) * (1- discount))+ o.freight AS "VALOR_TOTAL_ORD",
       cust.country
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 4,2,1
ORDER BY 3 DESC

---valor total de todas as orders de cada customer
SELECT cust.contact_name, SUM((dt.unit_price * dt. quantity) * (1- discount)+ o.freight) AS "VALOR_TOTAL",
       cust.country
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 1,3
ORDER BY 2 DESC


--- 5 paises total compras?
SELECT  SUM(dt.unit_price * dt. quantity) AS "TOTAL", cust.country
FROM orders AS o 
INNER JOIN order_details AS dt ON o.order_id = dt.order_id
INNER JOIN customers AS cust ON o.customer_id = cust.customer_id
GROUP BY 2
ORDER BY 1 DESC

---6
Select EXTRACT(MONTH FROM order_date)
FROM orders

SELECT AVG((det.unit_price * det.quantity)* (1- det.discount)) "MEAN", EXTRACT(MONTH FROM ord.order_date) AS "MONTH"
FROM order_details AS det
INNER JOIN orders AS ord ON det.order_id = ord.order_id
GROUP BY 2
ORDER BY 1 DESC


---- utilizo AS com UNION
SELECT cpf, nome, idade, cidade, identificacao
FROM (
	 SELECT cpf, nome, idade, cidade, 'Paciente' AS identificacao
	 FROM pacientes
	 UNION
	 SELECT cpf, nome, idade, cidade, 'funcionario' AS identificacao 
	 FROM funcionarios
	 UNION 
	 SELECT cpf, nome, idade, cidade, 'medicos' AS identificacao 
	 FROM medicos) 
AS todas_pessoas
WHERE cidade = 'Varginha';